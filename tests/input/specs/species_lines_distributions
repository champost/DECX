# Test species lines distributions file parsing.

Success: Base parsing of dummy species lines distributions file.
diff (config.toml): PERSIST
    data = "distrib_legacy.txt"
    data = "distrib_species_lines.txt"
Matrix:
           WP EP WN EN CA SA AF MD IN WA AU
     Amis: 1  1  0  1  0  1  1  0  1  0  0
     Asin: 0  1  0  1  0  0  1  0  1  0  1
    Ccroc: 1  1  0  1  0  1  0  0  1  0  1
     Clat: 1  1  0  0  0  0  0  0  1  0  0
     Cyac: 0  1  1  0  0  0  0  0  1  0  1
      Gav: 1  1  0  0  0  0  0  0  1  0  0 # differ from legacy to test inclusion
      Tom: 1  1  1  1  0  0  1  0  1  0  1

Success: Missing header is allowed.
diff (distrib_species_lines.txt):
    s\a   WP EP WN EN CA SA AF MD IN WA AU
    s\a # Implicitly relies on order defined in configuration file.

Success: Change order in header.
diff (distrib_species_lines.txt):
    s\a   WP EP WN EN CA SA AF MD IN WA AU
    s\a   WP EP WN EN CA SA AF MD AU IN WA # rotate last three columns
Matrix:
           WP EP WN EN CA SA AF MD IN WA AU
     Amis: 1  1  0  1  0  1  1  0  0  0  1
     Asin: 0  1  0  1  0  0  1  0  0  1  1
    Ccroc: 1  1  0  1  0  1  0  0  0  1  1
     Clat: 1  1  0  0  0  0  0  0  0  0  1
     Cyac: 0  1  1  0  0  0  0  0  0  1  1
      Gav: 1  1  0  0  0  0  0  0  1  0  0 # unchanged because by inclusion
      Tom: 1  1  1  1  0  0  1  0  1  0  1 # unchanged because by exclusion

Success: Include no areas in species line.
diff (distrib_species_lines.txt):
    Gav + WP EP IN
    Gav +
Matrix:
           WP EP WN EN CA SA AF MD IN WA AU
     Amis: 1  1  0  1  0  1  1  0  1  0  0
     Asin: 0  1  0  1  0  0  1  0  1  0  1
    Ccroc: 1  1  0  1  0  1  0  0  1  0  1
     Clat: 1  1  0  0  0  0  0  0  1  0  0
     Cyac: 0  1  1  0  0  0  0  0  1  0  1
      Gav: 0  0  0  0  0  0  0  0  0  0  0 # whole line set to one
      Tom: 1  1  1  1  0  0  1  0  1  0  1

Success: Exclude no areas in species line.
diff (distrib_species_lines.txt):
    Tom - CA SA MD WA
    Tom -
Matrix:
           WP EP WN EN CA SA AF MD IN WA AU
     Amis: 1  1  0  1  0  1  1  0  1  0  0
     Asin: 0  1  0  1  0  0  1  0  1  0  1
    Ccroc: 1  1  0  1  0  1  0  0  1  0  1
     Clat: 1  1  0  0  0  0  0  0  1  0  0
     Cyac: 0  1  1  0  0  0  0  0  1  0  1
      Gav: 1  1  0  0  0  0  0  0  1  0  0
      Tom: 1  1  1  1  1  1  1  1  1  1  1 # whole line set to zero

Failure: Catch incomplete header.
diff (distrib_species_lines.txt):
    s\a   WP EP WN EN CA SA AF MD IN WA AU
    s\a   WP EP WN    CA SA    MD IN WA AU
error (2):
    Error: the number of areas in the distribution file header (9)
    does not match the number of areas given in the configuration file (11).
    (line 1 column 39 in 'distrib_species_lines.txt')

Failure: Catch invalid area name.
diff (distrib_species_lines.txt):
    s\a   WP EP WN EN CA SA AF MD IN WA AU
    s\a   WP EP WN XX CA SA AF MD IN WA AU
error (2):
    Error: area name 'XX' found in distribution file
    does not match any area name given in configuration file.
    (line 1 column 16 in 'distrib_species_lines.txt')

Failure: Catch invalid binary digit in whitespace separated lines.
diff (distrib_species_lines.txt):
    Amis 1  1  0  1  0  1  1  0  1  0  0
    Amis 1  2a 0  1  0  1  1  0  1  0  0
error (2):
    Error: expected 1 or 0, got '2a'.
    (line 2 column 10 in 'distrib_species_lines.txt')

Failure: Catch extra digit in whitespace separated lines.
diff (distrib_species_lines.txt):
    Amis 1  1  0  1  0  1  1  0  1  0  0
    Amis 1  1  0  1  0  1  1  0  1  0  0  1
error (2):
    Error: too many digits in distribution specification:
    expected 11, got at least 12.
    (line 2 column 40 in 'distrib_species_lines.txt')

Failure: Catch missing digit in whitespace separated lines.
diff (distrib_species_lines.txt):
    Amis 1  1  0  1  0  1  1  0  1  0  0
    Amis 1  1  0  1  0  1  1  0  1  0
error (2):
    Error: not enough digits in distribution specification:
    expected 11, got only 10.
    (line 2 column 35 in 'distrib_species_lines.txt')

Failure: Catch invalid binary digit in legacy lines.
diff (distrib_species_lines.txt):
    Clat 11000000100
    Clat 11a00000100
error (2):
    Error: could not interpret token '11a00000100'
    as a species distribution specification.
    Consider using (only) ones and zeroes,
    or '+' or '-' to explicitly name areas.
    (line 7 column 6 in 'distrib_species_lines.txt')

Failure: Catch extra digit in legacy lines.
diff (distrib_species_lines.txt):
    Clat 11000000100
    Clat 110000001001
error (2):
    Error: too many digits in distribution specification:
    expected 11, got at least 12.
    (line 7 column 17 in 'distrib_species_lines.txt')

Failure: Catch missing digit in legacy lines.
diff (distrib_species_lines.txt):
    Clat 11000000100
    Clat 1100000010
error (2):
    Error: not enough digits in distribution specification:
    expected 11, got only 10.
    (line 7 column 16 in 'distrib_species_lines.txt')

Failure: Catch invalid area name in inclusion.
diff (distrib_species_lines.txt):
    Gav + WP EP IN
    Gav + WP wrong IN
error (2):
    Error: unrecognized area name: 'wrong'
    (line 11 column 10 in 'distrib_species_lines.txt')

Failure: Catch invalid area name in exclusion.
diff (distrib_species_lines.txt):
    Tom - CA SA MD WA
    Tom - CA SA MD wrong
error (2):
    Error: unrecognized area name: 'wrong'
    (line 12 column 16 in 'distrib_species_lines.txt')

Failure: Catch duplicated species name.
diff (distrib_species_lines.txt):
    Clat 11000000100
    Amis 11000000100
error (2):
    Error: species 'Amis' is specified twice.
    (line 7 column 1 in 'distrib_species_lines.txt')

